<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analyzer</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-5.0.0.min.js"></script>\    <!-- Adicionando Plotly -->
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
</head>
<body>
    <h1>Upload your Excel file</h1>
    
    <!-- Rótulo para o campo de upload -->
    <label for="file-upload">Escolha um arquivo Excel para fazer upload:</label>
    <input type="file" id="file-upload" name="file" title="Escolha um arquivo Excel" placeholder="Selecione um arquivo" />
    <button type="submit" id="upload-btn">Upload</button>

    <div id="graph-container"></div>
    <div id="status-message"></div> <!-- Para exibir mensagens de status -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Coloque todo o código JavaScript aqui para garantir que os elementos estejam carregados
            var socket = io.connect();
    
            // Logando a conexão para ver se o socket está funcionando corretamente
            socket.on('connect', function() {
                console.log('Conectado ao WebSocket');
            });
    
            // Recebe o gráfico e atualiza a página
            socket.on('update_graph', function(data) {
                console.log('Atualizando gráfico:', data.graph_html);
                document.getElementById('graph-container').innerHTML = data.graph_html;
            });
    
            // Enviar o arquivo quando o formulário for enviado
            document.getElementById('upload-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                var formData = new FormData();
                var file = document.getElementById('file-upload').files[0];
                formData.append('file', file);
    
                // Feedback de carregamento
                document.getElementById('status-message').innerHTML = "Enviando arquivo...";
    
                // Desabilita o botão de upload enquanto o arquivo é enviado
                document.getElementById('upload-btn').disabled = true;
    
                fetch('/upload', {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message); // Mensagem de sucesso
                    document.getElementById('status-message').innerHTML = data.message;
                    document.getElementById('upload-btn').disabled = false; // Reabilita o botão
                })
                .catch(error => {
                    console.error('Erro ao enviar arquivo:', error);
                    document.getElementById('status-message').innerHTML = 'Erro ao enviar arquivo. Tente novamente.';
                    document.getElementById('upload-btn').disabled = false; // Reabilita o botão em caso de erro
                });
            });
        });
    </script>    
</body>
</html>
